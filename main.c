
#include <avr/io.h>
void cham64_keygen(uint8_t* rks, const uint8_t* mk);
extern void cham64_encrypt(uint8_t*dst, const uint8_t* src, const uint8_t* rks);
extern void cham64_decrypt(uint8_t* dst, const uint8_t* src, const uint8_t* rks);

extern void cham128_keygen(uint8_t* rks, const uint8_t* mk);
extern void cham128_encrypt(uint8_t*dst, const uint8_t* src, const uint8_t* rks);
extern void cham128_decrypt(uint8_t*dst, const uint8_t* src, const uint8_t* rks);


extern void cham256_keygen(uint8_t* rks, const uint8_t* mk);
extern void cham256_encrypt(uint8_t*dst, const uint8_t* src, const uint8_t* rks);
extern void cham256_decrypt(uint8_t*dst, const uint8_t* src, const uint8_t* rks);

uint8_t rks[] __attribute__ ((section(".RKSection")))  ={0};
	
void test_cham64()
{
	uint8_t mk[] ={ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, };
	
	uint8_t pt[] ={ 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, };
	
	uint8_t ct[8] = {0x79, 0x69, 0x04, 0x12, 0x3f, 0x12, 0xa9, 0xe5};
		
	uint8_t IV[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
	
	uint16_t pt_len =sizeof(pt);  //8, 배열 수 
	

	uint8_t encrypted[8] ={0,};   // 카운터모드 할 때 주의.
	uint8_t decrypted[8] ={0,};
		
	cham64_keygen(rks,mk);    // key schedule
	cham64_encrypt(encrypted,pt,rks);// 1-block encrypt/decrypt
	cham64_decrypt(decrypted,ct,rks);
	cham64_ctr_encrypt(encrypted,pt,pt_len,IV,rks);// CTR encrypt/decrypt
	cham64_ctr_encrypt(decrypted,encrypted,pt_len,IV,rks);
}

void test_cham128()
{
	uint8_t mk[] ={ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f, };
	
	uint8_t pt[] ={ 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, };
		
	uint8_t ct[16] = {0}; //{0xee, 0x19, 0x54, 0xd0, 0x4c, 0x8f, 0x11, 0x9f, 0x69, 0x64, 0xe3, 0x99, 0xc1, 0x5e, 0x88, 0x1c, };
	
	uint8_t encrypted[16] ={0,};
	uint8_t decrypted[16] ={0,};
		
	uint8_t IV[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
		
	uint16_t pt_len =sizeof(pt);
		
	cham128_keygen(rks,mk);// key schedule
	cham128_encrypt(ct,pt,rks); // 1-block encrypt/decrypt
	cham128_decrypt(pt,ct,rks);
	cham128_ctr_encrypt(encrypted,pt,pt_len,IV,rks);// CTR encrypt/decrypt
	cham128_ctr_encrypt(decrypted,encrypted,pt_len,IV,rks);
}

void test_cham256()
{
	
	uint8_t mk[] = {
		0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
		0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xF5, 0xf6, 0xf7, 0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,
	};

    uint8_t pt[] = {
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff,
	};

	uint8_t ct[] = {
		0xdc, 0x77, 0x73, 0x02, 0x51, 0x56, 0x0b, 0x12, 0x95, 0x9b, 0x83, 0x8f, 0x75, 0xc0, 0x5e, 0x5e
	};
	
	uint8_t encrypted[16] ={0,};
	uint8_t decrypted[16] ={0,};
		
	uint8_t IV[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
	
	uint16_t pt_len =sizeof(pt);		
		
		
	cham256_keygen(rks,mk);// key schedule
	cham256_encrypt(encrypted,pt,rks);// 1-block encrypt/decrypt
  	cham256_decrypt(decrypted,ct,rks);
	cham256_ctr_encrypt(encrypted,pt,pt_len,IV,rks);// CTR encrypt/decrypt
	cham256_ctr_encrypt(decrypted,encrypted,pt_len,IV,rks);
}

int main(void)
{
	// variables...
	
	test_cham64();
	test_cham128();
	test_cham256();
	
}

